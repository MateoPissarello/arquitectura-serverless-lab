
# ğŸ—ï¸ Arquitectura Serverless Lab (AWS)

Laboratorio prÃ¡ctico para entender y demostrar los conceptos de **arquitectura serverless** usando **AWS Lambda + DynamoDB Streams**.  

Este proyecto crea un flujo tÃ­pico:

**Cliente HTTP â†’ Lambda HTTP â†’ DynamoDB (orders) â†’ Stream â†’ Lambda Worker â†’ DynamoDB (orders_enriched)**

## ğŸ“– Objetivo

Implementar un sistema simple de **gestiÃ³n de pedidos** en serverless:

1. **HTTP Lambda** (`POST /orders`): crea un pedido en DynamoDB (`orders`).  
2. **Stream Lambda**: cada vez que se inserta un pedido, DynamoDB Streams dispara esta funciÃ³n, que **enriquece el pedido** (ej. calcula IVA) y lo guarda en la tabla `orders_enriched`.  

---

## ğŸ› ï¸ Requisitos

- Tener instalada la **AWS CLI** 
- Tener configurado los credenciales de la cuenta de AWS
- **Terraform â‰¥ 1.6** (se recomienda [terraform-bin en AUR](https://aur.archlinux.org/packages/terraform-bin) o tfenv)  
- Permisos en AWS para crear: Lambda, IAM Roles/Policies, DynamoDB, CloudWatch Logs  

---

## ğŸ“‚ Estructura
```
â”œâ”€ app/
â”‚ â”œâ”€ handler_http.py # Lambda HTTP: crea pedidos
â”‚ â””â”€ handler_stream.py # Lambda Stream: enriquece pedidos
â”œâ”€ main.tf # Infraestructura principal (Lambdas, tablas, IAM)
â”œâ”€ variables.tf # Variables (regiÃ³n, prefix)
â”œâ”€ outputs.tf # Salidas (URL de funciÃ³n, nombres de tablas)
â””â”€ versions.tf # Requisitos de providers Terraform
```

## ğŸš€ Despliegue

### 1. Inicializar y aplicar
```bash
terraform init
terraform apply -auto-approve
```
Al finalizar, obtendrÃ¡s:

- Function URL â†’ endpoint pÃºblico para POST /orders
- Nombre de las tablas DynamoDB (orders, orders_enriched)

## ğŸ” Prueba rÃ¡pida

### 1. Crear Pedido 
```bash
curl -s -X POST "<reemplazar por FUNCTION_URL>" \
  -H "Content-Type: application/json" \
  -d '{"customer":"mateo","amount":123.45}'
# => {"ok": true, "order_id": "...."}
```
### 2. Verificar enriquecido
```bash
ORDER_ID="<el_id_devuelto>"
aws dynamodb get-item \
  --table-name serverless-lab-orders-enriched \
  --key "{\"order_id\":{\"S\":\"$ORDER_ID\"}}" \
  --region us-east-1
```

Respuesta esperada:
```json
{
  "Item": {
    "order_id": {"S": "uuid..."},
    "subtotal": {"N": "123.45"},
    "tax": {"N": "23.46"},
    "total": {"N": "146.91"},
    "status": {"S": "ENRICHED"}
  }
}
```


## ğŸ§¹ Destruir

Para destruir la infraestructura basta con ejecutar el comando:
```bash
terraform destroy -auto-approve
```